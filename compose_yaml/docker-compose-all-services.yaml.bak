version: '3.2'

services:  
 
    woven_server:
        image: woven_platform:${PLATFORM_IMAGE_TAG}  
        container_name: woven_server
        expose:
            - "17510"
        environment:
            WOVEN_BOOT: woven_server
        depends_on:
            - woven_mysql
        volumes:
            - "platform_logs:/woven_platform/logs:rw"
            - "platform_conf:/woven_platform/conf:rw"
            - "/etc/hadoop/conf:/etc/hadoop/conf"
            - "/app:/app"
            - /mytmp:/tmp/mytmp
        extra_hosts:
            - "baymax-deploy-03:192.168.2.81"
        network_mode: "host"

    woven_discovery:
        image: woven_platform:${PLATFORM_IMAGE_TAG}
        container_name: discovery
        depends_on:
            - woven_server
        ports:
            - "8518:8518"
        environment:
            WOVEN_BOOT: woven_discovery
        volumes:
            - "platform_logs:/woven_platform/logs:rw"
            - "platform_conf:/woven_platform/conf:rw"
            - "/etc/hadoop/conf:/etc/hadoop/conf"
            - "/app:/app"
            - /mytmp:/tmp/mytmp
        extra_hosts:
            - "baymax-deploy-03:192.168.2.81"
        network_mode: "host"
        
    woven_pipeline:
        image: woven_platform:${PLATFORM_IMAGE_TAG}
        container_name: woven_pipeline
        restart: always
        expose:
            - "17511"
        environment:
            WOVEN_BOOT: woven_pipeline
        depends_on:
            - woven_discovery
        volumes:
            - "platform_logs:/woven_platform/logs:rw"
            - "platform_conf:/woven_platform/conf:rw"
            - "/etc/hadoop/conf:/etc/hadoop/conf"
            - "/app:/app"
            - /mytmp:/tmp/mytmp
        extra_hosts:
            - "baymax-deploy-03:192.168.2.81"
        network_mode: "host"

    woven_more_executor:
        image: woven_platform:${PLATFORM_IMAGE_TAG}
        container_name: more_executor
        expose:
            - "17513"
        depends_on:
            - woven_discovery
        environment:
            WOVEN_BOOT: woven_executor_more
        volumes:
            - "platform_logs:/woven_platform/logs:rw"
            - "platform_conf:/woven_platform/conf:rw"
            - "/etc/hadoop/conf:/etc/hadoop/conf"
            - "/app:/app"
            - /mytmp:/tmp/mytmp
        extra_hosts:
            - "baymax-deploy-03:192.168.2.81"
        network_mode: "host"

    woven_df_executor:
        image: woven_platform:${PLATFORM_IMAGE_TAG}
        container_name: df-executor
        expose:
            - "17512"
        depends_on:
            - woven_discovery
        environment:
            WOVEN_BOOT: woven_executor_df
        volumes:
            - "platform_logs:/woven_platform/logs:rw"
            - "platform_conf:/woven_platform/conf:rw"
            - "/etc/hadoop/conf:/etc/hadoop/conf"
            - "/app:/app"
            - /mytmp:/tmp/mytmp
        network_mode: "host"
        extra_hosts:
            - "baymax-deploy-03:192.168.2.81"
    
    woven_livy:
        image: woven_platform:${PLATFORM_IMAGE_TAG}
        container_name: livy
        expose:
            - "8998"
        depends_on:
            - woven_discovery
        environment:
            WOVEN_BOOT: woven_livy
        volumes:
            - "livy_logs:/woven_platform/livy-server/logs:rw"
            - "livy_conf:/woven_platform/livy-server/conf:rw"
            - "/etc/hadoop/conf:/etc/hadoop/conf"
            - "/app:/app"
            - /mytmp:/tmp/mytmp
        network_mode: "host"
        extra_hosts:
            - "baymax-deploy-03:192.168.2.81"

    woven_app:
        image: woven_app:${WOVEN_APP_IMAGE_TAG}
        container_name: app
        expose:
            - "8514"
        depends_on:
            - woven_discovery
        volumes:
            - "app_logs:/woven_app/logs:rw"
            - "app_conf:/woven_app/conf:rw"
            - "app_ui:/woven_app/woven-ui:rw"
            - "/etc/hadoop/conf:/etc/hadoop/conf"
            - "/app:/app"
            - /mytmp:/tmp/mytmp
        extra_hosts:
            - "baymax-deploy-03:192.168.2.81"
        network_mode: "host"
   
volumes:
    platform_conf:
    platform_logs:
    livy_logs:
    livy_conf: 
    app_logs:
    app_conf:
    app_ui:
